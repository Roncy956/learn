import{_ as ee,r as c,o as ae,a as p,k as te,b as k,l as le,e as t,w as s,f as d,m as se,d as E,E as i,n as V,t as m,h as b,p as oe,q as ne,g as C,v as ce,i as ie,x as re}from"./index.cf62a217.js";import{g as de,a as ue,b as pe,d as P,u as ge,c as fe}from"./user.9d002244.js";const ve={class:"file-list-container"},_e={class:"capacity-info"},me={class:"capacity-text"},he={class:"toolbar"},we={class:"actions"},ye={class:"main-content"},be={class:"file-name-cell"},Ce={__name:"FileList",setup(xe){const z=c(""),g=c([]),u=c(1),x=c(5),S=c(0),B=c(!1),h=c([]),R=c(0),U=c(0),I=c(0),L=c(),f=c([]),M=c(!1),N=e=>e.endsWith("/")||!e.includes("."),D=e=>{if(!e||e<=0)return"\u2014";const a=1024,n=["B","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+n[l]},j=e=>e?new Date(e).toLocaleString("zh-CN"):"\u2014",F=async()=>{try{const e=await de(localStorage.getItem("id")),a=await ue();e.code&&a.code?(U.value=a.data,I.value=e.data.usedStorage,R.value=parseFloat((I.value/U.value*100).toFixed(2))):i.error(e.msg||"\u83B7\u53D6\u7528\u6237\u5BB9\u91CF\u5931\u8D25")}catch(e){i.error("\u83B7\u53D6\u7528\u6237\u5BB9\u91CF\u5931\u8D25\uFF1A"+(e.message||"\u672A\u77E5\u9519\u8BEF"))}},v=async()=>{B.value=!0;try{const e=await pe(localStorage.getItem("id"),z.value,u.value,x.value);if(e.code)h.value=e.data.rows||[],S.value=e.data.total||0;else throw new Error(e.msg||"\u83B7\u53D6\u6587\u4EF6\u5931\u8D25")}catch(e){i.error("\u83B7\u53D6\u6587\u4EF6\u5217\u8868\u5931\u8D25\uFF1A"+(e.message||"\u672A\u77E5\u9519\u8BEF")),h.value=[],S.value=0}finally{B.value=!1}},T=async(e,a)=>{try{const n=await fe(e),l=new Blob([n],{type:"application/octet-stream"}),r=window.URL.createObjectURL(l),_=document.createElement("a");_.href=r,_.download=a,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(r)}catch(n){console.error("\u4E0B\u8F7D\u5931\u8D25:",n)}},$=async()=>{var e;if(g.value.length!==0){await V.confirm(`\u786E\u5B9A\u5220\u9664 ${g.value.length} \u4E2A\u6587\u4EF6\uFF1F`,"\u8B66\u544A",{type:"warning"});try{const a=g.value.map(r=>r.id).join(","),n=localStorage.getItem("id"),l=await P(n,a);if(l.code)i.success("\u5220\u9664\u6210\u529F"),g.value=[],h.value.length&&h.value.length<=g.value.length&&(u.value=Math.max(1,u.value-1)),await v(),F();else throw new Error(l.msg||"\u5220\u9664\u5931\u8D25")}catch(a){((e=a==null?void 0:a.response)==null?void 0:e.status)!==400&&i.error("\u5220\u9664\u5931\u8D25\uFF1A"+(a.message||"\u672A\u77E5\u9519\u8BEF"))}}},K=async e=>{await V.confirm("\u786E\u5B9A\u5220\u9664\u6B64\u6587\u4EF6\uFF1F","\u8B66\u544A",{type:"warning"});try{const a=await P(localStorage.getItem("id"),e);if(a.code)i.success("\u5220\u9664\u6210\u529F"),await v(),F();else throw new Error(a.msg||"\u5220\u9664\u5931\u8D25")}catch(a){i.error("\u5220\u9664\u5931\u8D25\uFF1A"+(a.message||"\u672A\u77E5\u9519\u8BEF"))}},O=(e,a)=>{f.value=a.map(n=>n.raw)},q=async()=>{var a,n;if(f.value.length===0){i.warning("\u8BF7\u5148\u9009\u62E9\u8981\u4E0A\u4F20\u7684\u6587\u4EF6");return}M.value=!0;const e=new FormData;f.value.forEach(l=>{e.append("file",l)}),e.append("userId",localStorage.getItem("id"));try{const l=await ge(e);l.code?(i.success("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F"),u.value=1,v(),F(),f.value=[],L.value.clearFiles()):(i.error(l.msg||"\u4E0A\u4F20\u5931\u8D25"),f.value=[],L.value.clearFiles())}catch(l){console.error("\u6279\u91CF\u4E0A\u4F20\u5931\u8D25:",l),i.error("\u4E0A\u4F20\u51FA\u9519\uFF1A"+(((n=(a=l.response)==null?void 0:a.data)==null?void 0:n.msg)||l.message||"\u7F51\u7EDC\u9519\u8BEF"))}finally{M.value=!1}},G=e=>{g.value=e},W=()=>{u.value=1,v()},A=e=>{x.value=e,u.value=1,v()},H=e=>{u.value=e,v()};return ae(()=>{v(),F()}),(e,a)=>{const n=p("el-progress"),l=p("el-card"),r=p("el-icon"),_=p("el-input"),w=p("el-button"),J=p("el-upload"),y=p("el-table-column"),Q=p("el-table"),X=p("el-pagination"),Y=te("loading");return k(),le("div",ve,[t(l,{class:"capacity-card",shadow:"never"},{default:s(()=>[d("div",_e,[a[3]||(a[3]=d("span",{class:"capacity-text"},"\u5BB9\u91CF\uFF1A",-1)),t(n,{percentage:R.value,"text-inside":!0,"stroke-width":26,"show-text":!0,class:"capacity-progress"},null,8,["percentage"]),d("span",me,m(D(I.value))+" / "+m(D(U.value)),1)])]),_:1}),d("div",he,[t(_,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=o=>z.value=o),placeholder:"\u641C\u7D22\u6587\u4EF6\u540D...",clearable:"",onInput:W,class:"search-input"},{prefix:s(()=>[t(r,null,{default:s(()=>[t(b(oe))]),_:1})]),_:1},8,["modelValue"]),d("div",we,[t(J,{ref_key:"uploadRef",ref:L,"auto-upload":!1,multiple:"","on-change":O,"show-file-list":!1},{default:s(()=>[t(w,{type:"success"},{default:s(()=>[t(r,null,{default:s(()=>[t(b(ne))]),_:1}),a[4]||(a[4]=d("span",null,"\u9009\u62E9\u6587\u4EF6",-1))]),_:1})]),_:1},512),t(w,{type:"primary",loading:M.value,disabled:f.value.length===0,onClick:q},{default:s(()=>[C(" \u4E0A\u4F20\u6240\u9009 ("+m(f.value.length)+") ",1)]),_:1},8,["loading","disabled"]),t(w,{type:"danger",disabled:g.value.length===0,onClick:$},{default:s(()=>[t(r,null,{default:s(()=>[t(b(ce))]),_:1}),d("span",null,"\u5220\u9664\u9009\u4E2D ("+m(g.value.length)+")",1)]),_:1},8,["disabled"])])]),d("div",ye,[se((k(),E(Q,{data:h.value,style:{width:"100%"},onSelectionChange:G,"row-key":"id","empty-text":"\u6682\u65E0\u6587\u4EF6",class:"file-table","max-height":"570"},{default:s(()=>[t(y,{type:"selection",width:"48",align:"center"}),t(y,{prop:"name",label:"\u6587\u4EF6\u540D"},{default:s(({row:o})=>[d("div",be,[N(o.name)?(k(),E(r,{key:0,class:"icon-folder"},{default:s(()=>[t(b(ie))]),_:1})):(k(),E(r,{key:1,class:"icon-file"},{default:s(()=>[t(b(re))]),_:1})),d("span",null,m(o.name),1)])]),_:1}),t(y,{prop:"size",label:"\u5927\u5C0F",width:"110",align:"center"},{default:s(({row:o})=>[C(m(D(o.size)),1)]),_:1}),t(y,{prop:"uploadTime",label:"\u4E0A\u4F20\u65F6\u95F4",width:"180",align:"center"},{default:s(({row:o})=>[C(m(j(o.uploadTime)),1)]),_:1}),t(y,{label:"\u64CD\u4F5C",width:"180",align:"center"},{default:s(({row:o})=>[t(w,{size:"small",type:"primary",onClick:Z=>T(o.id,o.name)},{default:s(()=>[...a[5]||(a[5]=[C(" \u4E0B\u8F7D ",-1)])]),_:1},8,["onClick"]),t(w,{size:"small",type:"danger",onClick:Z=>K(o.id)},{default:s(()=>[...a[6]||(a[6]=[C(" \u5220\u9664 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,B.value]])]),t(X,{"current-page":u.value,"onUpdate:currentPage":a[1]||(a[1]=o=>u.value=o),"page-size":x.value,"onUpdate:pageSize":a[2]||(a[2]=o=>x.value=o),total:S.value,layout:"total, sizes, prev, pager, next","page-sizes":[5,10,15,20],class:"pagination",onSizeChange:A,onCurrentChange:H},null,8,["current-page","page-size","total"])])}}},ze=ee(Ce,[["__scopeId","data-v-48933009"]]);export{ze as default};
