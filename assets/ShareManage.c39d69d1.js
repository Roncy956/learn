import{y as B,_ as Y,r as s,o as Z,a as n,k as ee,b as y,l as M,e as a,w as t,E as r,f as m,g as c,t as U,A as N,m as le,d as G}from"./index.7d1e7c23.js";import{b as ae}from"./user.309046b3.js";const te=f=>B.post("/user/share",f),oe=(f,h)=>B.get(`/user/share?shareUrl=${f}&password=${h}`),se=f=>B.post("/user/file",f);const re={class:"share-container"},ne={key:0,style:{"margin-top":"12px",color:"green"}},ie={class:"card-header"},de={key:0,style:{"margin-top":"16px"}},ue={class:"file-info-container"},pe={class:"file-name"},me={class:"file-size"},ce={class:"dialog-footer"},ve={__name:"ShareManage",setup(f){const h=s([]),k=s(0),S=s(1),D=s(10),I=s(""),z=s(!1),V=s(!1),i=s({userId:0,userFileId:null,fileName:"",password:""}),g=s(""),C=s(!1),_=s(!1),w=s({fileId:0,name:"",size:0}),d=s({userId:0,shareUrl:"",password:""}),F=s(!1),$=s(""),E=l=>{if(l===0)return"0 B";const e=1024,u=["B","KB","MB","GB"],p=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,p)).toFixed(2))+" "+u[p]},b=async()=>{z.value=!0;try{const l=await ae(localStorage.getItem("id"),I.value,S.value,D.value);l.code?(h.value=l.data.rows||[],k.value=l.data.total||0):r.error(l.msg||"\u83B7\u53D6\u6587\u4EF6\u5931\u8D25")}catch(l){r.error("\u8BF7\u6C42\u5931\u8D25"),console.error(l)}finally{z.value=!1}},K=l=>{S.value=l,b()},P=l=>{i.value={userId:localStorage.getItem("id"),userFileId:l.id,fileName:l.name,password:""},g.value="",V.value=!0},R=async()=>{if(!!i.value.userFileId){C.value=!0;try{const l=await te(i.value);l.code?(g.value=l.data,r.success("\u5206\u4EAB\u7801\u751F\u6210\u6210\u529F\uFF01")):r.error(l.msg||"\u751F\u6210\u5931\u8D25")}catch(l){r.error("\u7F51\u7EDC\u9519\u8BEF"),console.error(l)}finally{C.value=!1}}},j=()=>{navigator.clipboard.writeText(g.value).then(()=>{r.success("\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{r.warning("\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u624B\u52A8\u590D\u5236")})},H=async()=>{if(!d.value.shareUrl.trim()){r.warning("\u8BF7\u8F93\u5165\u5206\u4EAB\u7801");return}F.value=!0;try{const l=await oe(d.value.shareUrl,d.value.password);l.code&&l.data?(w.value={name:l.data.name||"\u672A\u77E5\u6587\u4EF6",size:l.data.size,fileId:l.data.id},_.value=!0):r.error(l.msg||"\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u4FE1\u606F")}catch(l){r.error("\u8BBF\u95EE\u5931\u8D25"),console.error(l)}finally{F.value=!1}},J=async()=>{try{const l={userId:localStorage.getItem("id"),fileId:w.value.fileId,originalName:w.value.name},e=await se(l);e.code?(r.success("\u6587\u4EF6\u5DF2\u4FDD\u5B58\u5230\u6211\u7684\u6587\u4EF6\uFF01"),_.value=!1,b()):r.error(e.msg||"\u4FDD\u5B58\u5931\u8D25")}catch(l){r.error("\u4FDD\u5B58\u5931\u8D25"),console.error(l)}};return Z(()=>{b()}),(l,e)=>{const u=n("el-input"),p=n("el-form-item"),v=n("el-button"),T=n("el-form"),L=n("el-card"),x=n("el-table-column"),O=n("el-table"),Q=n("el-pagination"),q=n("el-dialog"),A=n("el-descriptions-item"),W=n("el-descriptions"),X=ee("loading");return y(),M("div",re,[a(L,{style:{"margin-bottom":"20px"}},{header:t(()=>[...e[10]||(e[10]=[m("span",null,"\u901A\u8FC7\u5206\u4EAB\u7801\u8BBF\u95EE\u6587\u4EF6",-1)])]),default:t(()=>[a(T,{model:d.value,"label-width":"100px",inline:""},{default:t(()=>[a(p,{label:"\u5206\u4EAB\u7801"},{default:t(()=>[a(u,{modelValue:d.value.shareUrl,"onUpdate:modelValue":e[0]||(e[0]=o=>d.value.shareUrl=o),placeholder:"\u8BF7\u8F93\u5165\u5206\u4EAB\u7801",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(p,{label:"\u5BC6\u7801"},{default:t(()=>[a(u,{modelValue:d.value.password,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value.password=o),placeholder:"\u5982\u6709\u5BC6\u7801\u8BF7\u586B\u5199","show-password":"",style:{width:"160px"}},null,8,["modelValue"])]),_:1}),a(p,null,{default:t(()=>[a(v,{type:"success",onClick:H,loading:F.value},{default:t(()=>[...e[11]||(e[11]=[c(" \u8BBF\u95EE\u6587\u4EF6 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),$.value?(y(),M("div",ne,U($.value),1)):N("",!0)]),_:1}),a(L,null,{header:t(()=>[m("div",ie,[e[12]||(e[12]=m("span",null,"\u6211\u7684\u6587\u4EF6",-1)),a(u,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=o=>I.value=o),placeholder:"\u6309\u6587\u4EF6\u540D\u641C\u7D22",style:{width:"200px","margin-left":"20px"},onInput:b},null,8,["modelValue"])])]),default:t(()=>[le((y(),G(O,{data:h.value,style:{width:"100%"}},{default:t(()=>[a(x,{prop:"name",label:"\u6587\u4EF6\u540D",width:"460",align:"left"}),a(x,{prop:"size",label:"\u5927\u5C0F",align:"center"},{default:t(o=>[c(U(E(o.row.size)),1)]),_:1}),a(x,{prop:"uploadTime",label:"\u4E0A\u4F20\u65F6\u95F4",width:"180",align:"center"}),a(x,{label:"\u64CD\u4F5C",width:"120",align:"center"},{default:t(o=>[a(v,{size:"small",type:"primary",onClick:fe=>P(o.row)},{default:t(()=>[...e[13]||(e[13]=[c(" \u5206\u4EAB ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,z.value]]),k.value>0?(y(),G(Q,{key:0,layout:"total, prev, pager, next","current-page":S.value,"page-size":D.value,total:k.value,onCurrentChange:K,style:{"margin-top":"16px","text-align":"right"}},null,8,["current-page","page-size","total"])):N("",!0)]),_:1}),a(q,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=o=>V.value=o),title:"\u751F\u6210\u5206\u4EAB\u94FE\u63A5",width:"400px"},{footer:t(()=>[a(v,{onClick:e[6]||(e[6]=o=>V.value=!1)},{default:t(()=>[...e[16]||(e[16]=[c("\u53D6\u6D88",-1)])]),_:1}),a(v,{type:"primary",onClick:R,loading:C.value},{default:t(()=>[...e[17]||(e[17]=[c(" \u751F\u6210\u5206\u4EAB\u7801 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(T,{model:i.value,"label-width":"80px"},{default:t(()=>[a(p,{label:"\u6587\u4EF6\u540D"},{default:t(()=>[a(u,{modelValue:i.value.fileName,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.fileName=o),disabled:""},null,8,["modelValue"])]),_:1}),a(p,{label:"\u8BBF\u95EE\u5BC6\u7801"},{default:t(()=>[a(u,{modelValue:i.value.password,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.password=o),placeholder:"\u7559\u7A7A\u5219\u65E0\u9700\u5BC6\u7801","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),g.value?(y(),M("div",de,[e[15]||(e[15]=m("p",null,"\u5206\u4EAB\u7801\u5DF2\u751F\u6210\uFF1A",-1)),a(u,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),readonly:""},{append:t(()=>[a(v,{onClick:j},{default:t(()=>[...e[14]||(e[14]=[c("\u590D\u5236",-1)])]),_:1})]),_:1},8,["modelValue"])])):N("",!0)]),_:1},8,["modelValue"]),a(q,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=o=>_.value=o),title:"\u{1F4C4} \u6587\u4EF6\u9884\u89C8",width:"480px",class:"file-preview-dialog"},{footer:t(()=>[m("div",ce,[a(v,{onClick:e[8]||(e[8]=o=>_.value=!1)},{default:t(()=>[...e[18]||(e[18]=[c("\u53D6\u6D88",-1)])]),_:1}),a(v,{type:"primary",onClick:J,icon:"Download"},{default:t(()=>[...e[19]||(e[19]=[c(" \u4FDD\u5B58\u5230\u6211\u7684\u6587\u4EF6 ",-1)])]),_:1})])]),default:t(()=>[m("div",ue,[a(W,{column:1,size:"small",border:""},{default:t(()=>[a(A,{label:"\u6587\u4EF6\u540D",class:"file-name-item"},{default:t(()=>[m("span",pe,U(w.value.name),1)]),_:1}),a(A,{label:"\u6587\u4EF6\u5927\u5C0F"},{default:t(()=>[m("span",me,U(E(w.value.size)),1)]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}},we=Y(ve,[["__scopeId","data-v-74e1e171"]]);export{we as default};
