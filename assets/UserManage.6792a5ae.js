import{_ as ue,r,z as de,a as m,b as pe,l as ce,f as K,e as t,w as o,h as T,E as u,n as P,p as O,g as c,t as U}from"./index.cf62a217.js";import{g as me,d as ge,u as ve,a as fe}from"./admin.32e416f4.js";import{d as he,c as we}from"./user.9d002244.js";const ye={class:"user-manage-container"},be={class:"toolbar"},_e={class:"user-table-wrapper"},Ce={__name:"UserManage",setup(xe){const z=r([]),F=r(0),h=r(1),k=r(10),L=r(""),f=r([]),w=r(!1),$=r(null),n=de({id:null,name:"",password:"",phone:"",email:""}),G={name:[{required:!1,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],phone:[{required:!1,message:"\u8BF7\u8F93\u5165\u7535\u8BDD",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E",trigger:"blur"}],email:[{required:!1,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1",trigger:"blur"},{type:"email",message:"\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E",trigger:"blur"}]},D=r(!1),y=r(null),b=r([]),_=r(0),g=r(1),C=r(10),x=r(""),I=(l,e)=>{let d;return(...s)=>{clearTimeout(d),d=setTimeout(()=>l.apply(this,s),e)}},M=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",A=l=>{if(l==null||l===0)return"0 B";const e=1024,d=["B","KB","MB","GB"],s=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,s)).toFixed(2))+" "+d[s]},v=async()=>{try{const l=await me(L.value,h.value,k.value);l.code?(z.value=l.data.rows||[],F.value=l.data.total||0):(u.error(l.msg||"\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25"),z.value=[],F.value=0)}catch(l){u.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5"),console.error(l),z.value=[],F.value=0}},V=async()=>{try{const l=await fe(y.value.id,x.value,g.value,C.value);l.code?(b.value=l.data.rows||[],_.value=l.data.total||0):(u.error(l.msg||"\u83B7\u53D6\u6587\u4EF6\u5217\u8868\u5931\u8D25"),b.value=[],_.value=0)}catch(l){u.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5"),console.error(l),b.value=[],_.value=0}},H=async l=>{P.confirm(`\u786E\u5B9A\u5220\u9664\u6587\u4EF6 "${l.name}"\uFF1F`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{try{const e=await he(y.value.id,[l.id]);e.code?(u.success("\u5220\u9664\u6210\u529F"),V(),v()):u.error(e.msg||"\u5220\u9664\u5931\u8D25")}catch(e){u.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),console.error(e)}})},J=async l=>{try{const e=await we(l.id),d=new Blob([e],{type:"application/octet-stream"}),s=window.URL.createObjectURL(d),i=document.createElement("a");i.href=s,i.download=l.name,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}catch(e){console.error("\u4E0B\u8F7D\u5931\u8D25:",e)}},Q=l=>{f.value=l.map(e=>e.id)},W=l=>{h.value=l,v()},X=l=>{k.value=l,v()},Y=I(()=>{h.value=1,v()},500),Z=l=>{n.id=l.id,n.name="",n.password="",n.phone="",n.email="",w.value=!0},ee=async()=>{if(!!$.value)try{await $.value.validate();const l={id:n.id,name:n.name,phone:n.phone,email:n.email,password:n.password},e=await ve(l);e.code?(u.success("\u7528\u6237\u4FE1\u606F\u66F4\u65B0\u6210\u529F"),w.value=!1,v()):u.error(e.msg||"\u66F4\u65B0\u5931\u8D25")}catch(l){console.error("\u66F4\u65B0\u5931\u8D25:",l),u.error("\u9A8C\u8BC1\u6216\u63D0\u4EA4\u5931\u8D25")}},le=l=>{P.confirm(`\u786E\u5B9A\u5220\u9664\u7528\u6237 "${l.name}"\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u9006\u3002`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{E([l.id])})},te=()=>{P.confirm(`\u786E\u5B9A\u6279\u91CF\u5220\u9664 ${f.value.length} \u4E2A\u7528\u6237\uFF1F`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{E(f.value)})},E=async l=>{if(!(!l||l.length===0))try{const e=l.join(","),d=await ge(e);d.code?(u.success("\u5220\u9664\u6210\u529F"),f.value=[],v()):u.error(d.msg||"\u5220\u9664\u5931\u8D25")}catch(e){console.error("\u5220\u9664\u8BF7\u6C42\u5931\u8D25:",e),u.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},ae=I(()=>{g.value=1,V()},500),oe=l=>{g.value=l,V()},ne=l=>{C.value=l,V()},re=l=>{y.value={...l},x.value="",g.value=1,D.value=!0,V()},se=()=>{b.value=[],_.value=0,x.value="",g.value=1,C.value=10,y.value=null};return v(),(l,e)=>{var q;const d=m("el-icon"),s=m("el-input"),i=m("el-button"),p=m("el-table-column"),R=m("el-table"),N=m("el-pagination"),B=m("el-form-item"),ie=m("el-form"),j=m("el-dialog");return pe(),ce("div",ye,[K("div",be,[t(s,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),placeholder:"\u8F93\u5165\u7528\u6237\u540D\u641C\u7D22...",style:{width:"300px"},clearable:"",onInput:T(Y)},{prefix:o(()=>[t(d,null,{default:o(()=>[t(T(O))]),_:1})]),_:1},8,["modelValue","onInput"]),t(i,{type:"danger",disabled:f.value.length===0,onClick:te},{default:o(()=>[c(" \u6279\u91CF\u5220\u9664 ("+U(f.value.length)+") ",1)]),_:1},8,["disabled"])]),K("div",_e,[t(R,{data:z.value,style:{width:"100%","margin-top":"16px"},"row-key":"id",onSelectionChange:Q,"max-height":"650"},{default:o(()=>[t(p,{type:"selection",width:"50"}),t(p,{prop:"name",label:"\u7528\u6237\u540D",width:"150"}),t(p,{prop:"phone",label:"\u7535\u8BDD",width:"140"}),t(p,{prop:"email",label:"\u90AE\u7BB1","min-width":"200"}),t(p,{prop:"ownedFiles",label:"\u6587\u4EF6\u6570",width:"80",align:"center"}),t(p,{label:"\u6CE8\u518C\u65F6\u95F4",width:"180",align:"center"},{default:o(({row:a})=>[c(U(M(a.createTime)),1)]),_:1}),t(p,{label:"\u6700\u540E\u66F4\u65B0",width:"180",align:"center"},{default:o(({row:a})=>[c(U(M(a.updateTime)),1)]),_:1}),t(p,{label:"\u64CD\u4F5C",width:"220",align:"center"},{default:o(({row:a})=>[t(i,{size:"small",type:"primary",onClick:S=>Z(a)},{default:o(()=>[...e[13]||(e[13]=[c(" \u7F16\u8F91 ",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:"success",onClick:S=>re(a)},{default:o(()=>[...e[14]||(e[14]=[c(" \u67E5\u770B\u6587\u4EF6 ",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:"danger",onClick:S=>le(a)},{default:o(()=>[...e[15]||(e[15]=[c(" \u5220\u9664 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),t(N,{"current-page":h.value,"onUpdate:currentPage":e[1]||(e[1]=a=>h.value=a),"page-size":k.value,"onUpdate:pageSize":e[2]||(e[2]=a=>k.value=a),total:F.value,layout:"total, sizes, prev, pager, next","page-sizes":[5,10,15,20],style:{"margin-top":"20px","text-align":"right"},onSizeChange:X,onCurrentChange:W},null,8,["current-page","page-size","total"]),t(j,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=a=>w.value=a),title:"\u7F16\u8F91\u7528\u6237\u4FE1\u606F",width:"500px"},{footer:o(()=>[t(i,{onClick:e[7]||(e[7]=a=>w.value=!1)},{default:o(()=>[...e[16]||(e[16]=[c("\u53D6\u6D88",-1)])]),_:1}),t(i,{type:"primary",onClick:ee},{default:o(()=>[...e[17]||(e[17]=[c("\u4FDD\u5B58",-1)])]),_:1})]),default:o(()=>[t(ie,{model:n,"label-width":"80px",rules:G,ref_key:"editFormRef",ref:$},{default:o(()=>[t(B,{label:"\u7528\u6237\u540D",prop:"name"},{default:o(()=>[t(s,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.name=a),placeholder:"\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539"},null,8,["modelValue"])]),_:1}),t(B,{label:"\u5BC6\u7801"},{default:o(()=>[t(s,{modelValue:n.password,"onUpdate:modelValue":e[4]||(e[4]=a=>n.password=a),placeholder:"\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539","show-password":""},null,8,["modelValue"])]),_:1}),t(B,{label:"\u7535\u8BDD",prop:"phone"},{default:o(()=>[t(s,{modelValue:n.phone,"onUpdate:modelValue":e[5]||(e[5]=a=>n.phone=a),placeholder:"\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539"},null,8,["modelValue"])]),_:1}),t(B,{label:"\u90AE\u7BB1",prop:"email"},{default:o(()=>[t(s,{modelValue:n.email,"onUpdate:modelValue":e[6]||(e[6]=a=>n.email=a),placeholder:"\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(j,{modelValue:D.value,"onUpdate:modelValue":e[12]||(e[12]=a=>D.value=a),title:`\u300C${(q=y.value)==null?void 0:q.name}\u300D\u7684\u6587\u4EF6\u5217\u8868`,width:"700px",onClosed:se},{default:o(()=>[t(s,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=a=>x.value=a),placeholder:"\u8F93\u5165\u6587\u4EF6\u540D\u641C\u7D22...",style:{width:"250px","margin-bottom":"16px"},clearable:"",onInput:T(ae)},{prefix:o(()=>[t(d,null,{default:o(()=>[t(T(O))]),_:1})]),_:1},8,["modelValue","onInput"]),t(R,{data:b.value,style:{width:"100%"},"empty-text":"\u6682\u65E0\u6587\u4EF6"},{default:o(()=>[t(p,{prop:"name",label:"\u6587\u4EF6\u540D","min-width":"200"}),t(p,{label:"\u5927\u5C0F",width:"90",align:"center"},{default:o(({row:a})=>[c(U(A(a.size)),1)]),_:1}),t(p,{label:"\u4E0A\u4F20\u65F6\u95F4",width:"160",align:"center"},{default:o(({row:a})=>[c(U(M(a.uploadTime)),1)]),_:1}),t(p,{label:"\u64CD\u4F5C",width:"150",align:"center"},{default:o(({row:a})=>[t(i,{size:"small",type:"primary",onClick:S=>J(a)},{default:o(()=>[...e[18]||(e[18]=[c(" \u4E0B\u8F7D ",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:"danger",onClick:S=>H(a)},{default:o(()=>[...e[19]||(e[19]=[c(" \u5220\u9664 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(N,{"current-page":g.value,"onUpdate:currentPage":e[10]||(e[10]=a=>g.value=a),"page-size":C.value,"onUpdate:pageSize":e[11]||(e[11]=a=>C.value=a),total:_.value,layout:"total, sizes, prev, pager, next","page-sizes":[5,10,15,20],style:{"margin-top":"16px","text-align":"right"},onSizeChange:ne,onCurrentChange:oe},null,8,["current-page","page-size","total"])]),_:1},8,["modelValue","title"])])}}},Fe=ue(Ce,[["__scopeId","data-v-7c536eeb"]]);export{Fe as default};
