import{_ as S,z as x,r as v,o as $,a as s,b as V,l as j,e as o,w as t,E as u,f as U,h as M,j as R,g as d,d as E,t as p}from"./index.7d1e7c23.js";import{g as L,e as O}from"./user.309046b3.js";const q={class:"profile-container"},G={class:"card-header"},H={__name:"Profile",setup(J){const h=r=>r?new Date(r).toLocaleString("zh-CN"):"\u2014",i=x({id:null,name:"",email:"",phone:"",fileCount:0,createdAt:"",updatedAt:""}),f=v(!1),_=v(),a=x({name:"",email:"",phone:"",password:""}),w=v(!1),b=v(!0),I={name:[],email:[{validator:(r,e,l)=>{e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?l():(l(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u683C\u5F0F")),u.error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u683C\u5F0F")):l()},trigger:"blur"}],phone:[{validator:(r,e,l)=>{e?/^1[3-9]\d{9}$/.test(e)?l():(l(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u4E2D\u56FD\u5927\u9646\u624B\u673A\u53F7")),u.error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u4E2D\u56FD\u5927\u9646\u624B\u673A\u53F7")):l()},trigger:"blur"}],password:[]},k=()=>{const r=localStorage.getItem("id");return r?parseInt(r,10):(u.error("\u672A\u767B\u5F55\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55"),null)},C=async()=>{const r=k();if(!!r)try{b.value=!0;const e=await L(r);if(e.code===1){const l=e.data;Object.assign(i,{id:l.id,name:l.name||"",email:l.email||"",phone:l.phone||"",fileCount:l.ownedFiles||0,createdAt:l.createTime,updatedAt:l.updateTime})}else u.error(e.data.msg||"\u52A0\u8F7D\u5931\u8D25")}catch(e){console.error("\u52A0\u8F7D\u7528\u6237\u4FE1\u606F\u5931\u8D25:",e),u.error("\u7F51\u7EDC\u9519\u8BEF\u6216\u767B\u5F55\u5DF2\u5931\u6548\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55")}finally{b.value=!1}},A=()=>{a.name="",a.email="",a.phone="",a.password="",f.value=!0},F=()=>{_.value&&_.value.resetFields()},B=async()=>{!_.value||await _.value.validate(async r=>{if(!!r){w.value=!0;try{const e={id:i.id,name:a.name,email:a.email,phone:a.phone,password:a.password},l=await O(e);l.code?(u.success("\u4FE1\u606F\u5DF2\u66F4\u65B0"),a.name&&localStorage.setItem("name",a.name),C(),f.value=!1):u.error(l.msg||"\u4FDD\u5B58\u5931\u8D25")}catch(e){console.error("\u66F4\u65B0\u5931\u8D25:",e),u.error("\u66F4\u65B0\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u7A0D\u540E\u91CD\u8BD5")}finally{w.value=!1}}})};return $(()=>{C()}),(r,e)=>{const l=s("el-icon"),y=s("el-button"),N=s("el-skeleton"),m=s("el-descriptions-item"),P=s("el-descriptions"),T=s("el-card"),c=s("el-input"),g=s("el-form-item"),z=s("el-form"),D=s("el-dialog");return V(),j("div",q,[o(T,{class:"box-card",shadow:"hover"},{header:t(()=>[U("div",G,[o(l,null,{default:t(()=>[o(M(R))]),_:1}),e[7]||(e[7]=U("span",null,"\u4E2A\u4EBA\u4FE1\u606F",-1)),o(y,{type:"primary",size:"small",onClick:A,style:{"margin-left":"auto"}},{default:t(()=>[...e[6]||(e[6]=[d(" \u66F4\u6539\u4FE1\u606F ",-1)])]),_:1})])]),default:t(()=>[b.value?(V(),E(N,{key:0,rows:6,animated:""})):(V(),E(P,{key:1,column:1,border:""},{default:t(()=>[o(m,{label:"\u59D3\u540D"},{default:t(()=>[d(p(i.name||"\u672A\u8BBE\u7F6E"),1)]),_:1}),o(m,{label:"\u90AE\u7BB1"},{default:t(()=>[d(p(i.email||"\u672A\u7ED1\u5B9A"),1)]),_:1}),o(m,{label:"\u624B\u673A\u53F7"},{default:t(()=>[d(p(i.phone||"\u672A\u7ED1\u5B9A"),1)]),_:1}),o(m,{label:"\u62E5\u6709\u7684\u6587\u4EF6\u6570"},{default:t(()=>[d(p(i.fileCount),1)]),_:1}),o(m,{label:"\u521B\u5EFA\u65F6\u95F4"},{default:t(()=>[d(p(h(i.createdAt)),1)]),_:1}),o(m,{label:"\u6700\u540E\u66F4\u65B0"},{default:t(()=>[d(p(h(i.updatedAt)),1)]),_:1})]),_:1}))]),_:1}),o(D,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=n=>f.value=n),title:"\u7F16\u8F91\u4E2A\u4EBA\u4FE1\u606F",width:"500px",onClose:F},{footer:t(()=>[o(y,{onClick:e[4]||(e[4]=n=>f.value=!1)},{default:t(()=>[...e[8]||(e[8]=[d("\u53D6\u6D88",-1)])]),_:1}),o(y,{type:"primary",onClick:B,loading:w.value},{default:t(()=>[...e[9]||(e[9]=[d("\u4FDD\u5B58 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[o(z,{model:a,rules:I,ref_key:"editFormRef",ref:_,"label-width":"80px"},{default:t(()=>[o(g,{label:"\u59D3\u540D",prop:"name"},{default:t(()=>[o(c,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.name=n),placeholder:"\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539"},null,8,["modelValue"])]),_:1}),o(g,{label:"\u90AE\u7BB1",prop:"email"},{default:t(()=>[o(c,{modelValue:a.email,"onUpdate:modelValue":e[1]||(e[1]=n=>a.email=n),placeholder:"\u586B\u5199\u6B63\u786E\u7684\u90AE\u7BB1\u683C\u5F0F\uFF0C\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539"},null,8,["modelValue"])]),_:1}),o(g,{label:"\u624B\u673A\u53F7",prop:"phone"},{default:t(()=>[o(c,{modelValue:a.phone,"onUpdate:modelValue":e[2]||(e[2]=n=>a.phone=n),placeholder:"\u4EC5\u652F\u6301\u4E2D\u56FD\u5927\u9646\u624B\u673A\u53F7\uFF0C\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539"},null,8,["modelValue"])]),_:1}),o(g,{label:"\u5BC6\u7801",prop:"password"},{default:t(()=>[o(c,{modelValue:a.password,"onUpdate:modelValue":e[3]||(e[3]=n=>a.password=n),type:"password",placeholder:"\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},W=S(H,[["__scopeId","data-v-5b17f1f3"]]);export{W as default};
